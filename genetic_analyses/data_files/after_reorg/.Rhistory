library(adegenet)
###############################################
############## Working Directory ##############
###############################################
butternut_drive <- "C:\\Users\\eschumacher\\Documents\\GitHub\\Butternut"
setwd(butternut_drive)
##three pop genind and genpop files
butternut_3pop_gen <- read.genepop("Genetic_Analyses\\data_files\\before_reorg\\butternut_3pops.gen", ncode = 3)
butternut_3pop_pop <- genind2genpop(butternut_3pop_gen)
##create list of loci
loci <- c("B114","B159","WGA","A5_2","B157","B212_2","B121",	"B147",	"B249",	"B262","B264")
##loop to compare scoring between Jeanne and Sean
pdf("Genetic_Analyses\\genetic_analyses_results\\butternut_3pop_scoring_barplot.pdf",width=40,height=9)
for(a in loci){
butternut_3pop_scoring <- butternut_3pop_pop[,which(grepl(a,colnames(butternut_3pop_pop@tab)))]@tab
for(p in 1:3) butternut_3pop_scoring[p,]<-butternut_3pop_scoring[p,]/sum(butternut_3pop_scoring[p,])
butternut_3pop_scoring_barplot <- barplot(butternut_3pop_scoring, las = 2, beside = TRUE, col = c("firebrick4","firebrick2","dodgerblue"), legend.text =  c("Canada_Sean", "Canada_Jean","United States"), ylim = c(0,1), main = paste0(a))
}
dev.off()
library(adegenet)
library(Demerelate)
library(poppr)
#####################################
############ Directories ############
#####################################
butternut_drive <- "C:\\Users\\eschumacher\\Documents\\GitHub\\Butternut"
#####################################
############# Load Files ############
#####################################
setwd(butternut_drive)
##load current working reorganized genepop file
butternutgen_reorg <- read.genepop("Genetic_Analyses\\data_files\\after_reorg\\postgeo_rebin_24pop.gen", ncode = 3)
##reduce genind file for individuals with greater than 25% missing data
butternutgen_nomd <- missingno(butternutgen_reorg, type = "geno", cutoff = 0.25, quiet = FALSE, freq = FALSE)
##load relatedness file
reorg_relatedness <- read.csv("Genetic_Analyses\\data_files\\after_reorg\\reorg_relatedness.csv")
###################################################################
############# Reduced Individuals based on Relatedness ############
###################################################################
##rename individuals in genind file
rownames(butternutgen_nomd@tab) <- reorg_relatedness$Ind
##create pop name code
butternut_24pop_names <- unique(reorg_relatedness$Pop)
##rename populations in genind no missing data file
levels(butternutgen_nomd@pop) <- butternut_24pop_names
####reduce relatedness
##run relatedness code
reorg_relate_df <- Demerelate(reorg_relatedness, object = T, value = "loiselle")
##now identify how many individuals have greater than 25% relatedness = half siblings
butternut_halfsib_names <- names(which(unlist(reorg_relate_df$Empirical_Relatedness) > 0.25))
##then use this to create a document which has all the unique individual numbers for every highly related individuals
butternut_halfsib_names_cleanfront <- gsub("^.*\\.","", butternut_halfsib_names)
butternut_halfsib_names_cleanback <- gsub("^.*\\_","", butternut_halfsib_names_cleanfront)
relate_ind_remove <- unique(butternut_halfsib_names_cleanback)
##then subset genind file
butternutgen_relatedness_reduced <- butternutgen_nomd[!rownames(butternutgen_nomd@tab) %in% relate_ind_remove,]
##subset data frame
reorg_relatedness_reduced <- reorg_relatedness[!reorg_relatedness$Ind %in% relate_ind_remove,]
###name pops
levels(butternutgen_relatedness_reduced@pop) <- butternut_24pop_names
##write out genind file in genalex format
setwd("Genetic_Analyses\\data_files\\after_reorg")
butternutgen_relatedness_reduced <- genind2genalex(butternutgen_relatedness_reduced,
filename = "butternutgen_relatedness_reduced.csv")
write.csv(reorg_relatedness_reduced, "reorg_relatedness_reduced.csv")
##write out no missing data genind file and then convert to genind in genalex
butternutgen_nomd <- genind2genalex(butternutgen_nomd, filename = "butternutgen_nomd.csv")
